<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<polymer-element name="chapter-list" attributes="mangaId mangaTitle">
  <template>
		<style>
     .row {
			 margin: 0;
			 padding: 10px;
			 border: 1px solid red;
     }
    </style>
		
		<core-scroll-panel fit>
			<core-toolbar>
				<paper-icon-button icon="arrow-back" on-click="{{backClicked}}"></paper-icon-button>
				<div>{{mangaTitle}}</div>
			</core-toolbar>

			<core-ajax
				 id="ajax"
				 handleAs="json"
				 response="{{chapterList}}"></core-ajax>
			<core-list
				 id="list"
				 style="min-height:10px"
				 data="{{chapterList.chapters}}"
				 height="50"
				 on-core-activate="{{selectChapter}}">
				<template>
					<div class="row" horizontal layout>
						<div>Chapter {{model[0]}}: {{model[2]}}</div>
						<div flex></div>
						<div>{{dateFromEpoch(model[1])}}</div>
					</div>
				</template>
			</core-list>
		</core-scroll-panel>
  </template>
	<script>
    Polymer({
		  mangaIdChanged: function (oldValue, newValue) {
		    console.log(newValue);
		    this.$.ajax.url = "https://cors-anywhere.herokuapp.com/www.mangaeden.com/api/manga/" + newValue + "/";
		    this.$.ajax.go();
  		},
  		selectChapter: function (event, detail, sender) {
		    console.log(detail);
		    this.fire("chapter-selected", {
		        id: detail.data[3],
		        number: detail.data[0],
		        title: detail.data[2]});
      },
		  backClicked: function () {
		    this.fire("back", {});
		  },
		  dateFromEpoch: function (seconds) {
		    return (new Date(seconds * 1000)).toLocaleDateString();
		  }
    });
	</script>
</polymer-element>
