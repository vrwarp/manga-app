<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">

<polymer-element name="manga-list">
  <template>
		<style>
      .row {
        height: 500px;
  			width: 400px;
			  margin: 0;
			  padding: 10px;
			  border: 1px solid red;
      }
    </style>

		<core-header-panel mode="seamed" fit>
			<core-toolbar>
				<div>Manga App</div>
			</core-toolbar>

			<core-ajax
				 auto
				 url="http://www.corsproxy.com/www.mangaeden.com/api/list/0/?p=0&l=200"
				 handleAs="json"
				 response="{{mangaList}}"
				 on-core-error="{{retryOnFail}}"></core-ajax>
			<core-list
				 id="list"
				 style="min-height:10px"
				 data="{{mangaList.manga}}"
				 height="500"
				 width="400"
				 grid
				 on-core-activate="{{selectManga}}">
				<template>
					<div class="row">
						{{model.t}}
					</div>
				</template>
			</core-list>
		</core-header-panel>
  </template>
	<script>
    Polymer({
		  retryOnFail: function () {
		    console.log("Failed, retrying in 1 second...");
        var self = this;
		    window.setTimeout(function() {
		        self.go();
  		    }, 1000);
		  },
  		selectManga: function (event, detail, sender) {
		    console.log(detail.data);
		    this.fire('manga-selected', {
		        id: detail.data.i,
		        title: detail.data.t});
      }
    });
	</script>
</polymer-element>
